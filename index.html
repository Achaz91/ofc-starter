<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Coaching Digital Starter â€“ OFC</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#0D244F" />
  <link rel="manifest" href="manifest.webmanifest" />

  <style>
    :root {
      --bg: #f7f1e8;
      --primary: #0d244f;
      --accent: #d4a017;
      --card-bg: #ffffff;
      --border: #e0d7c8;
      --text-main: #111827;
      --text-muted: #6b7280;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, sans-serif;
    }

    body {
      background: radial-gradient(circle at top, #fff7ec 0, #f7f1e8 45%, #f3ebdf 100%);
      color: var(--text-main);
    }

    .app {
      max-width: 480px;
      margin: 0 auto;
      min-height: 100vh;
    }

    header {
      padding: 12px 16px;
      background: rgba(255, 255, 255, 0.95);
      border-bottom: 1px solid var(--border);
      backdrop-filter: blur(6px);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .header-top {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .logo-circle {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      border: 2px solid var(--accent);
      background: url('icons/icon-192.png') center/cover no-repeat;
    }

    h1 {
      font-size: 1.05rem;
      color: var(--primary);
      font-weight: 700;
    }

    header p {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .badge {
      margin-top: 6px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 8px;
      font-size: 0.7rem;
      border-radius: 999px;
      background: #fff8e6;
      color: #8a5308;
      border: 1px solid #ecd9b4;
    }

    .badge-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--accent);
    }

    .lang-switch {
      margin-top: 8px;
      text-align: right;
    }

    .lang-btn {
      background: #eee0c5;
      border: 1px solid #d6c2a3;
      color: #0d244f;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 0.75rem;
      margin-left: 5px;
    }

    .lang-btn.active {
      background: #0d244f;
      color: white;
    }

    .tabs {
      display: flex;
      background: #eee0c5;
      padding: 3px;
      border-radius: 999px;
      margin: 10px 12px 0;
    }

    .tab-btn {
      flex: 1;
      border: none;
      background: transparent;
      padding: 8px;
      border-radius: 999px;
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .tab-btn.active {
      background: var(--card-bg);
      color: var(--primary);
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }

    main {
      padding: 10px 10px 80px;
    }

    .card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 12px;
      margin-bottom: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .card h2 {
      font-size: 0.95rem;
      margin-bottom: 6px;
      color: var(--primary);
    }

    .subtitle {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-bottom: 10px;
    }

    label {
      font-size: 0.75rem;
      margin-bottom: 2px;
      display: block;
    }

    input,
    select {
      width: 100%;
      padding: 8px;
      border-radius: 10px;
      background: #fdf8f1;
      border: 1px solid var(--border);
      font-size: 0.8rem;
    }

    input:focus,
    select:focus {
      outline: none;
      border-color: var(--accent);
      background: white;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
      border: none;
      padding: 9px;
      border-radius: 999px;
      margin-top: 6px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .btn-danger {
      background: #b91c1c;
    }

    .list {
      max-height: 250px;
      overflow-y: auto;
      margin-top: 10px;
    }

	.mini-stats {
	  margin-top: 12px;
	  border-top: 1px dashed #e0d7c8;
	  padding-top: 8px;
	}

	.mini-title {
	  font-size: 0.8rem;
	  color: #4b5563;
	  margin-bottom: 6px;
	}

	.mini-chart-block {
	  margin-bottom: 8px;
	}

	.mini-chart-header {
	  font-size: 0.75rem;
	  color: #6b7280;
	  margin-bottom: 4px;
	}

	.mini-chart {
	  display: flex;
	  align-items: flex-end;
	  gap: 4px;
	  height: 60px;
	}

	.mini-bar {
	  flex: 1;
	  display: flex;
	  flex-direction: column;
	  align-items: center;
	}

	.mini-bar-col {
	  width: 8px;
	  border-radius: 999px 999px 0 0;
	  background: #0d244f;
	  opacity: 0.9;
	}

	.mini-bar-label {
	  font-size: 0.6rem;
	  color: #6b7280;
	  margin-top: 2px;
	}


    .row {
      display: flex;
      justify-content: space-between;
      padding: 7px 0;
      border-bottom: 1px dashed #ddd;
    }

    .product-scroll {
      max-height: 180px;
      overflow-y: auto;
      margin-bottom: 10px;
    }

    .product-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    .product-card {
      background: #fdf8f1;
      border-radius: 12px;
      padding: 6px;
      text-align: center;
      border: 1px solid #e9d8b8;
    }

    .product-card img {
      width: 100%;
      height: 80px;
      border-radius: 10px;
      object-fit: cover;
    }

    .bottom-bar {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      background: #fff;
      border-top: 1px solid var(--border);
      padding: 8px 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 480px;
      margin: 0 auto;
    }

    .wa-btn {
      background: #25D366;
      color: #ffffff;
      padding: 7px 12px;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 600;
      text-decoration: none;
      margin-left: 10px;
    }
  </style>
</head>

<body>
<div class="app">

<header>
  <div class="header-top">
    <div class="logo-circle"></div>
    <div>
      <h1>Coaching Digital Starter</h1>
      <p>OFC Digital â€” Suivi quotidien</p>
    </div>
  </div>

  <div class="badge">
    <span class="badge-dot"></span>
    <span data-i18n="local_storage"></span>
  </div>

  <div class="lang-switch">
    <button class="lang-btn" onclick="setLang('fr')">FR</button>
    <button class="lang-btn" onclick="setLang('en')">EN</button>
  </div>
</header>
<div class="tabs">
  <button class="tab-btn active" data-tab="ventes" data-i18n="ventes"></button>
  <button class="tab-btn" data-tab="depenses" data-i18n="depenses"></button>
  <button class="tab-btn" data-tab="resume" data-i18n="resume"></button>
</div>

<main>

<!-- ============================
     SECTION : VENTES
=============================== -->
<section id="tab-ventes" class="card">
  <h2 data-i18n="enregistrer_vente"></h2>
  <p class="subtitle" data-i18n="click_product"></p>

  <div class="product-scroll">
    <div class="product-grid">

      <div class="product-card" onclick="selectProduct('Chaussure homme bleue',15000)">
        <img src="products/man_shoes.webp">
        <div>Chaussure homme</div>
        <small>15 000 FCFA</small>
      </div>

      <div class="product-card" onclick="selectProduct('Escarpin argentÃ© femme',20000)">
        <img src="products/woman_shoes.jpeg">
        <div>Escarpin femme</div>
        <small>20 000 FCFA</small>
      </div>

      <div class="product-card" onclick="selectProduct('Sac homme Polo Videng',18000)">
        <img src="products/man_bag.webp">
        <div>Sac homme Polo</div>
        <small>18 000 FCFA</small>
      </div>

      <div class="product-card" onclick="selectProduct('Parfum homme FACC 100 ml',22000)">
        <img src="products/man_perfum.webp">
        <div>Parfum homme FACC</div>
        <small>22 000 FCFA</small>
      </div>

      <div class="product-card" onclick="selectProduct('Sac Ã  main femme Elegancia',25000)">
        <img src="products/woman_bag.webp">
        <div>Sac femme Elegancia</div>
        <small>25 000 FCFA</small>
      </div>

      <div class="product-card" onclick="selectProduct('Parfum femme Shalimar 90 ml',28000)">
        <img src="products/woman_parfum.webp">
        <div>Parfum femme Shalimar</div>
        <small>28 000 FCFA</small>
      </div>

    </div>
  </div>

  <form id="form-vente">
    <label data-i18n="du"></label>
    <input type="date" id="vente-date" required>

    <label data-i18n="description_client"></label>
    <input type="text" id="vente-client" required>

    <label data-i18n="montant"></label>
    <input type="number" id="vente-montant" required>

    <label data-i18n="mode_paiement"></label>
    <select id="vente-mode">
      <option value="Cash">Cash</option>
      <option value="Mobile Money">Mobile Money</option>
    </select>

    <button class="btn-primary" data-i18n="ajouter_vente"></button>
  </form>

  <div id="liste-ventes" class="list"></div>
</section>
<!-- ============================
     SECTION : DÃ‰PENSES
=============================== -->
<section id="tab-depenses" class="card" style="display:none;">
  <h2 data-i18n="enregistrer_depense"></h2>

  <form id="form-depense">
    <label data-i18n="du"></label>
    <input type="date" id="dep-date" required>

    <label data-i18n="nature"></label>
    <input type="text" id="dep-nature" required>

    <label data-i18n="montant"></label>
    <input type="number" id="dep-montant" required>

    <label data-i18n="fournisseur"></label>
    <input type="text" id="dep-fournisseur">

    <button class="btn-primary" data-i18n="ajouter_depense"></button>
  </form>

  <div id="liste-depenses" class="list"></div>
</section>

<!-- ============================
     SECTION : RÃ‰SUMÃ‰
=============================== -->
<section id="tab-resume" class="card" style="display:none;">
  <h2 data-i18n="resume_precompte"></h2>

  <form id="form-filtre">
    <label data-i18n="du"></label>
    <input type="date" id="filtre-debut">

    <label data-i18n="au"></label>
    <input type="date" id="filtre-fin">

    <button class="btn-primary btn-secondary" data-i18n="filtrer"></button>
  </form>

  <div class="list" style="margin-top:10px;">
    <p id="sum-ventes"></p>
    <p id="sum-depenses"></p>
    <p id="benefice"></p>
    <p id="precompte"></p>
    <p id="cac"></p>
    <p id="total-precompte"></p>
    <p id="solde-net"></p>
  </div>

	<div class="mini-stats">
	  <h3 class="mini-title" data-i18n="stats_7d_title"></h3>

	  <div class="mini-chart-block">
		<div class="mini-chart-header" data-i18n="stats_7d_sales"></div>
		<div class="mini-chart" id="chart-ventes-7j"></div>
	  </div>

	  <div class="mini-chart-block">
		<div class="mini-chart-header" data-i18n="stats_7d_expenses"></div>
		<div class="mini-chart" id="chart-depenses-7j"></div>
	  </div>
	</div>


  <button id="btn-export-all" class="btn-primary" data-i18n="export_all"></button>


  <button id="btn-reset" class="btn-primary btn-danger" data-i18n="reset"></button>
</section>

</main>

<div class="bottom-bar">
  <div>
    <strong id="quick-total">0 FCFA</strong><br>
    <small data-i18n="solde_periode"></small>
  </div>

  <a href="https://wa.me/237687723233" target="_blank" class="wa-btn">
    ðŸ’¬ <span data-i18n="whatsapp"></span>
  </a>
</div>

</div> <!-- END APP CONTAINER -->
<!-- ============================
     SCRIPTS â€” LOGIQUE BILINGUE + APP
=============================== -->

<script>

/* ============================================================
   BILINGUISME FR / EN
============================================================ */

let currentLang = localStorage.getItem("ofcLang") || "fr";

const i18n = {
  fr: {
    ventes: "Ventes",
    depenses: "DÃ©penses",
    resume: "RÃ©sumÃ©",
    enregistrer_vente: "Enregistrer une vente",
    click_product: "Cliquez sur un produit pour prÃ©remplir la vente",
    du: "Date",
    description_client: "Description / Client",
    montant: "Montant (FCFA)",
    mode_paiement: "Mode de paiement",
    ajouter_vente: "Ajouter la vente",
    enregistrer_depense: "Enregistrer une dÃ©pense",
    nature: "Nature",
    fournisseur: "Fournisseur (optionnel)",
    ajouter_depense: "Ajouter la dÃ©pense",
    resume_precompte: "RÃ©sumÃ© & PrÃ©compte IGS",
    au: "Au",
    filtrer: "Filtrer",
    reset: "RÃ©initialiser les donnÃ©es",
    local_storage: "DonnÃ©es stockÃ©es dans votre tÃ©lÃ©phone",

    // bouton export global
    export_all: "Exporter toutes les donnÃ©es",

    // RÃ©sumÃ©
    aucune_vente: "Aucune vente",
    aucune_depense: "Aucune dÃ©pense",
    ventes_txt: "Ventes",
    depenses_txt: "DÃ©penses",
    benefice_txt: "BÃ©nÃ©fice",
    igs_txt: "IGS (5%)",
    cac_txt: "CAC (10%)",
    total_precompte_txt: "Total prÃ©compte",
    solde_net_txt: "Solde net",
    confirm_reset: "Supprimer toutes les donnÃ©es ?",

    // CSV
    csv_col_date: "Date",
    csv_col_client: "Client",
    csv_col_amount: "Montant",
    csv_col_mode: "Mode",
    csv_col_nature: "Nature",
    csv_col_supplier: "Fournisseur",

    // Mini-stats
    stats_7d_title: "Tendance sur les 7 derniers jours",
    stats_7d_sales: "Ventes journaliÃ¨res",
    stats_7d_expenses: "DÃ©penses journaliÃ¨res"
  },

  en: {
    ventes: "Sales",
    depenses: "Expenses",
    resume: "Summary",
    enregistrer_vente: "Record a sale",
    click_product: "Tap a product to pre-fill the sale",
    du: "Date",
    description_client: "Description / Customer",
    montant: "Amount (XAF)",
    mode_paiement: "Payment method",
    ajouter_vente: "Add sale",
    enregistrer_depense: "Record an expense",
    nature: "Expense type",
    fournisseur: "Supplier (optional)",
    ajouter_depense: "Add expense",
    resume_precompte: "Summary & IGS withholding",
    au: "To",
    filtrer: "Filter",
    reset: "Reset data",
    local_storage: "Data stored on your phone",

    export_all: "Export all data",

    // RÃ©sumÃ©
    aucune_vente: "No sales",
    aucune_depense: "No expenses",
    ventes_txt: "Sales",
    depenses_txt: "Expenses",
    benefice_txt: "Profit",
    igs_txt: "IGS (5%)",
    cac_txt: "CAC (10%)",
    total_precompte_txt: "Total withholding",
    solde_net_txt: "Net balance",
    confirm_reset: "Delete all data?",

    // CSV
    csv_col_date: "Date",
    csv_col_client: "Customer",
    csv_col_amount: "Amount",
    csv_col_mode: "Method",
    csv_col_nature: "Expense type",
    csv_col_supplier: "Supplier",

    // Mini-stats
    stats_7d_title: "Trend over last 7 days",
    stats_7d_sales: "Daily sales",
    stats_7d_expenses: "Daily expenses"
  }
};

function setLang(lang) {
  currentLang = lang;
  localStorage.setItem("ofcLang", lang);
  translate();
  renderVentes();
  renderDepenses();
  computeSummary();
}

function translate() {
  document.querySelectorAll("[data-i18n]").forEach(el => {
    const key = el.getAttribute("data-i18n");
    el.innerHTML = i18n[currentLang][key] ?? key;
  });

  document.querySelectorAll(".lang-btn").forEach(btn => {
    btn.classList.remove("active");
    if (btn.textContent.toLowerCase() === currentLang) btn.classList.add("active");
  });
}

/* ============================================================
   LOGIQUE PRINCIPALE (VENTES / DÃ‰PENSES / SYNTHÃˆSE)
============================================================ */

const STORAGE_VENTES = "ofcStarterVentes";
const STORAGE_DEPENSES = "ofcStarterDepenses";

let ventes = [];
let depenses = [];

let filtreDebut = null;
let filtreFin = null;

function loadData() {
  ventes = JSON.parse(localStorage.getItem(STORAGE_VENTES) || "[]");
  depenses = JSON.parse(localStorage.getItem(STORAGE_DEPENSES) || "[]");
}

function saveData() {
  localStorage.setItem(STORAGE_VENTES, JSON.stringify(ventes));
  localStorage.setItem(STORAGE_DEPENSES, JSON.stringify(depenses));
}

function formatFCFA(n) {
  return Number(n || 0).toLocaleString("fr-FR") + " FCFA";
}

function selectProduct(name, price) {
  document.getElementById("vente-client").value = name;
  document.getElementById("vente-montant").value = price;
}

function renderVentes() {
  const box = document.getElementById("liste-ventes");
  if (!ventes.length) {
    box.innerHTML = `<p>${i18n[currentLang].aucune_vente}</p>`;
    return;
  }

  box.innerHTML = ventes
    .slice()
    .reverse()
    .map(v => `
      <div class="row">
        <span>${v.client}<br><small>${v.date}</small></span>
        <strong>${formatFCFA(v.montant)}</strong>
      </div>
    `)
    .join("");
}

function renderDepenses() {
  const box = document.getElementById("liste-depenses");
  if (!depenses.length) {
    box.innerHTML = `<p>${i18n[currentLang].aucune_depense}</p>`;
    return;
  }

  box.innerHTML = depenses
    .slice()
    .reverse()
    .map(d => `
      <div class="row">
        <span>${d.nature}<br><small>${d.date}</small></span>
        <strong>${formatFCFA(d.montant)}</strong>
      </div>
    `)
    .join("");
}

function isInPeriod(date, d1, d2) {
  const D = new Date(date);
  if (d1 && D < new Date(d1)) return false;
  if (d2 && D > new Date(d2)) return false;
  return true;
}

function computeSummary() {
  const vf = ventes.filter(v => isInPeriod(v.date, filtreDebut, filtreFin));
  const df = depenses.filter(d => isInPeriod(d.date, filtreDebut, filtreFin));

  const tv = vf.reduce((s, v) => s + v.montant, 0);
  const td = df.reduce((s, d) => s + d.montant, 0);
  const bene = tv - td;

  const pre = tv * 0.05;
  const cac = pre * 0.1;
  const tot = pre + cac;
  const net = bene - tot;

  document.getElementById("sum-ventes").textContent =
    i18n[currentLang].ventes_txt + " : " + formatFCFA(tv);

  document.getElementById("sum-depenses").textContent =
    i18n[currentLang].depenses_txt + " : " + formatFCFA(td);

  document.getElementById("benefice").textContent =
    i18n[currentLang].benefice_txt + " : " + formatFCFA(bene);

  document.getElementById("precompte").textContent =
    i18n[currentLang].igs_txt + " : " + formatFCFA(pre);

  document.getElementById("cac").textContent =
    i18n[currentLang].cac_txt + " : " + formatFCFA(cac);

  document.getElementById("total-precompte").textContent =
    i18n[currentLang].total_precompte_txt + " : " + formatFCFA(tot);

  document.getElementById("solde-net").textContent =
    i18n[currentLang].solde_net_txt + " : " + formatFCFA(net);

  document.getElementById("quick-total").textContent = formatFCFA(net);

  renderCharts();
}

/* ============================================================
   MINI-CHARTS (7 JOURS)
============================================================ */

function getLast7DaysSeries(entries) {
  const result = [];
  const today = new Date();

  for (let i = 6; i >= 0; i--) {
    const d = new Date(today);
    d.setDate(d.getDate() - i);

    const iso = d.toISOString().slice(0, 10);
    const label =
      d.getDate().toString().padStart(2, "0") +
      "/" +
      (d.getMonth() + 1).toString().padStart(2, "0");

    const total = entries
      .filter(e => e.date === iso)
      .reduce((s, e) => s + (e.montant || 0), 0);

    result.push({ label, total });
  }

  return result;
}

function renderMiniChart(containerId, series) {
  const container = document.getElementById(containerId);
  if (!container) return;

  const max = Math.max(...series.map(s => s.total), 1);

  container.innerHTML = series
    .map(s => {
      const height = Math.round((s.total / max) * 60);
      return `
        <div class="mini-bar">
          <div class="mini-bar-col" style="height:${height}px;"></div>
          <div class="mini-bar-label">${s.label}</div>
        </div>`;
    })
    .join("");
}

function renderCharts() {
  const vf = ventes.filter(v => isInPeriod(v.date, filtreDebut, filtreFin));
  const df = depenses.filter(d => isInPeriod(d.date, filtreDebut, filtreFin));

  renderMiniChart("chart-ventes-7j", getLast7DaysSeries(vf));
  renderMiniChart("chart-depenses-7j", getLast7DaysSeries(df));
}

/* ============================================================
   EXPORT GLOBAL UNIQUE (TXT + WhatsApp)
============================================================ */

function generateExportText() {
  let txt = "";
  const sep = "---------------------------------------------\n";

  txt += "OFC Digital â€” Coaching Starter\n";
  txt += (currentLang === "fr" ? "Export complet\n\n" : "Full export\n\n");

  txt += sep + (currentLang === "fr" ? "VENTES\n" : "SALES\n") + sep;
  if (!ventes.length) txt += (currentLang === "fr" ? "Aucune vente\n" : "No sales\n");
  else ventes.forEach(v => {
    txt += `â€¢ ${v.date} â€” ${v.client} â€” ${v.montant} FCFA â€” ${v.mode}\n`;
  });

  txt += "\n" + sep + (currentLang === "fr" ? "DÃ‰PENSES\n" : "EXPENSES\n") + sep;
  if (!depenses.length) txt += (currentLang === "fr" ? "Aucune dÃ©pense\n" : "No expenses\n");
  else depenses.forEach(d => {
    txt += `â€¢ ${d.date} â€” ${d.nature} â€” ${d.montant} FCFA â€” ${d.fournisseur}\n`;
  });

  const tv = ventes.reduce((s, v) => s + v.montant, 0);
  const td = depenses.reduce((s, d) => s + d.montant, 0);
  const bene = tv - td;
  const pre = tv * 0.05;
  const cac = pre * 0.1;
  const tot = pre + cac;
  const net = bene - tot;

  txt += "\n" + sep + (currentLang === "fr" ? "RÃ‰SUMÃ‰\n" : "SUMMARY\n") + sep;
  txt += `${i18n[currentLang].ventes_txt}: ${formatFCFA(tv)}\n`;
  txt += `${i18n[currentLang].depenses_txt}: ${formatFCFA(td)}\n`;
  txt += `${i18n[currentLang].benefice_txt}: ${formatFCFA(bene)}\n`;
  txt += `${i18n[currentLang].igs_txt}: ${formatFCFA(pre)}\n`;
  txt += `${i18n[currentLang].cac_txt}: ${formatFCFA(cac)}\n`;
  txt += `${i18n[currentLang].total_precompte_txt}: ${formatFCFA(tot)}\n`;
  txt += `${i18n[currentLang].solde_net_txt}: ${formatFCFA(net)}\n\n`;

  return txt;
}

function downloadExport() {
  const txt = generateExportText();
  const blob = new Blob([txt], { type: "text/plain" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = "export_ofc.txt";
  a.click();
}

function whatsappExport() {
  const txt = generateExportText();
  const encoded = encodeURIComponent(txt);
  window.open("https://wa.me/237687723233?text=" + encoded, "_blank");
}

/* ============================================================
   Ã‰VÃ‰NEMENTS & INITIALISATION (FORMULAIRES + TABS + FAB)
============================================================ */

document.addEventListener("DOMContentLoaded", () => {

  loadData();
  translate();
  renderVentes();
  renderDepenses();
  computeSummary();

  const today = new Date().toISOString().slice(0, 10);
  document.getElementById("vente-date").value = today;
  document.getElementById("dep-date").value = today;

  /* ---------- Form vente ---------- */
  document.getElementById("form-vente").onsubmit = e => {
    e.preventDefault();
    ventes.push({
      date: document.getElementById("vente-date").value,
      client: document.getElementById("vente-client").value,
      montant: Number(document.getElementById("vente-montant").value),
      mode: document.getElementById("vente-mode").value
    });

    saveData();
    renderVentes();
    computeSummary();

    e.target.reset();
    document.getElementById("vente-date").value = today;
  };

  /* ---------- Form dÃ©pense ---------- */
  document.getElementById("form-depense").onsubmit = e => {
    e.preventDefault();
    depenses.push({
      date: document.getElementById("dep-date").value,
      nature: document.getElementById("dep-nature").value,
      montant: Number(document.getElementById("dep-montant").value),
      fournisseur: document.getElementById("dep-fournisseur").value
    });

    saveData();
    renderDepenses();
    computeSummary();

    e.target.reset();
    document.getElementById("dep-date").value = today;
  };

  /* ---------- Filtre ---------- */
  document.getElementById("form-filtre").onsubmit = e => {
    e.preventDefault();
    filtreDebut = document.getElementById("filtre-debut").value || null;
    filtreFin = document.getElementById("filtre-fin").value || null;
    computeSummary();
  };

  /* ---------- Confirmation Reset ---------- */
  document.getElementById("btn-reset").onclick = () => {
    if (!confirm(i18n[currentLang].confirm_reset)) return;
    ventes = [];
    depenses = [];
    saveData();
    renderVentes();
    renderDepenses();
    computeSummary();
  };

  /* ---------- Tabs ---------- */
  document.querySelectorAll(".tab-btn").forEach(btn => {
    btn.onclick = () => {
      document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");

      const tab = btn.dataset.tab;
      document.querySelectorAll("main section").forEach(s => {
        s.style.display = s.id === "tab-" + tab ? "block" : "none";
      });
    };
  });

  /* ============================================================
     MENU FLOTTANT EXPORT / SHARE
  ============================================================= */

  const fab = document.getElementById("fab-main");
  const fabContainer = document.getElementById("fab-container");

  if (fab && fabContainer) {
    fab.onclick = () => {
      fabContainer.classList.toggle("open");
    };

    const fabExport = document.getElementById("fab-export");
    const fabWhats = document.getElementById("fab-whatsapp");

    if (fabExport) {
      fabExport.onclick = () => {
        downloadExport();
        fabContainer.classList.remove("open");
      };
    }

    if (fabWhats) {
      fabWhats.onclick = () => {
        whatsappExport();
        fabContainer.classList.remove("open");
      };
    }
  }

  /* ---------- PWA ---------- */
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("./service-worker.js", { scope: "./" });
  }
});

</script>


<!-- MENU FLOTTANT EXPORT / SHARE -->
<div id="fab-container">
  <button id="fab-main">â‡ª</button>

  <div id="fab-menu">
    <button id="fab-export" data-i18n="export_all">Exporter tout</button>
    <button id="fab-whatsapp">WhatsApp</button>
  </div>
</div>

<style>
#fab-container {
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 9999;
}

#fab-main {
  width: 58px;
  height: 58px;
  border-radius: 50%;
  background: #002d62;
  color: white;
  font-size: 32px;
  border: none;
  box-shadow: 0 3px 8px rgba(0,0,0,0.3);
}

#fab-menu {
  display: none;
  flex-direction: column;
  margin-bottom: 10px;
  gap: 8px;
}

#fab-menu button {
  padding: 10px 16px;
  border-radius: 24px;
  border: none;
  background: #002d62;
  color: white;
  font-size: 14px;
  box-shadow: 0 3px 6px rgba(0,0,0,0.25);
}

#fab-container.open #fab-menu {
  display: flex;
}
</style>

</body>
</html>
