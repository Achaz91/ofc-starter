<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OFC Starter – Coaching Digital</title>
  <meta name="theme-color" content="#0d244f" />

  <!-- PWA -->
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png" />

  <style>
    * { box-sizing: border-box; margin:0; padding:0; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:#f4eee3;
      color:#111827;
      min-height:100vh;
      display:flex;
      flex-direction:column;
      max-width:480px;
      margin:0 auto;
    }
    header {
      background:#0d244f;
      color:#fff;
      padding:12px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
    }
    header .brand {
      display:flex;
      align-items:center;
      gap:8px;
    }
    header .brand-logo {
      width:32px;
      height:32px;
      border-radius:999px;
      border:2px solid #fbbf24;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:700;
      font-size:14px;
      background:#fef9c3;
      color:#0d244f;
    }
    header h1 {
      font-size:15px;
      line-height:1.2;
    }
    header h1 span {
      display:block;
      font-size:11px;
      font-weight:400;
      opacity:.9;
    }
    .lang-switch {
      display:flex; gap:4px;
    }
    .lang-btn {
      border-radius:999px;
      border:1px solid rgba(255,255,255,.3);
      background:transparent;
      color:#fff;
      padding:4px 8px;
      font-size:11px;
      cursor:pointer;
    }
    .lang-btn.active {
      background:#fbbf24;
      color:#0d244f;
      border-color:#fbbf24;
    }
    nav.tabs {
      display:flex;
      border-bottom:1px solid #e5e7eb;
      background:#fefcf7;
    }
    .tab-btn {
      flex:1;
      padding:8px;
      font-size:13px;
      border:none;
      background:none;
      cursor:pointer;
      color:#374151;
      border-bottom:2px solid transparent;
    }
    .tab-btn.active {
      border-bottom-color:#0d244f;
      font-weight:600;
      color:#0d244f;
      background:#fff;
    }
    main {
      flex:1;
      padding:10px 12px 70px;
    }
    section { display:none; }
    section.active { display:block; }

    h2 {
      font-size:14px;
      margin-bottom:6px;
      color:#111827;
    }
    .hint {
      font-size:11px;
      color:#6b7280;
      margin-bottom:8px;
    }

    .products-grid {
      display:flex;
      overflow-x:auto;
      gap:8px;
      padding-bottom:6px;
      margin-bottom:10px;
    }
    .product-card {
      min-width:110px;
      border-radius:10px;
      border:none;
      background:#fff;
      box-shadow:0 1px 3px rgba(15,23,42,.15);
      padding:6px;
      text-align:left;
      cursor:pointer;
    }
    .product-card img {
      width:100%;
      height:80px;
      object-fit:cover;
      border-radius:8px;
      margin-bottom:4px;
    }
    .product-name {
      font-size:11px;
      font-weight:600;
      color:#111827;
    }
    .product-price {
      font-size:11px;
      color:#065f46;
    }

    form {
      background:#fff;
      border-radius:10px;
      padding:10px;
      box-shadow:0 1px 3px rgba(15,23,42,.1);
      margin-bottom:10px;
    }
    .field {
      margin-bottom:8px;
    }
    label {
      font-size:11px;
      color:#4b5563;
      display:block;
      margin-bottom:2px;
    }
    input, select, textarea {
      width:100%;
      border-radius:8px;
      border:1px solid #d1d5db;
      padding:6px 8px;
      font-size:13px;
      font-family:inherit;
      background:#f9fafb;
    }
    textarea { min-height:50px; resize:vertical; }
    .btn-primary {
      width:100%;
      border:none;
      border-radius:999px;
      padding:8px;
      background:#0d244f;
      color:#fff;
      font-size:13px;
      font-weight:600;
      cursor:pointer;
      margin-top:4px;
    }
    .btn-primary:active { transform:scale(.98); }
    .btn-danger {
      background:#b91c1c;
      color:#fff;
    }
    .btn-row {
      display:flex;
      gap:6px;
      margin-top:8px;
    }
    .btn-row button { flex:1; }

    .list {
      background:#fff;
      border-radius:10px;
      padding:8px;
      box-shadow:0 1px 3px rgba(15,23,42,.08);
      font-size:12px;
    }
    .row {
      display:flex;
      justify-content:space-between;
      gap:6px;
      padding:4px 0;
      border-bottom:1px dashed #e5e7eb;
    }
    .row:last-child { border-bottom:none; }
    .row small { color:#6b7280; }

    .summary-box p {
      font-size:12px;
      margin-bottom:2px;
    }
    .summary-box p strong { font-weight:600; }

    footer {
      position:fixed;
      bottom:0;
      left:50%;
      transform:translateX(-50%);
      max-width:480px;
      width:100%;
      background:#fefcf7;
      border-top:1px solid #e5e7eb;
      padding:6px 10px;
      font-size:10px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      color:#6b7280;
    }
    footer span:last-child { font-weight:600; color:#0d244f; }
  </style>
</head>
<body>
<header>
  <div class="brand">
    <div class="brand-logo">OFC</div>
    <h1>
      OFC Starter
      <span>Coaching Digital – Essai</span>
    </h1>
  </div>
  <div class="lang-switch">
    <button class="lang-btn active" onclick="setLang('fr')">FR</button>
    <button class="lang-btn" onclick="setLang('en')">EN</button>
  </div>
</header>

<nav class="tabs">
  <button class="tab-btn active" data-tab="sales" data-i18n="ventes"></button>
  <button class="tab-btn" data-tab="expenses" data-i18n="depenses"></button>
  <button class="tab-btn" data-tab="summary" data-i18n="resume"></button>
</nav>

<main>
  <!-- VENTES -->
  <section id="tab-sales" class="active">
    <h2 data-i18n="enregistrer_vente"></h2>
    <p class="hint" data-i18n="click_product"></p>

    <div class="products-grid">
      <button class="product-card" data-name="Chaussures homme" data-price="20000">
        <img src="products/man_shoes.webp" alt="Shoes man" />
        <div class="product-name">Chaussures homme</div>
        <div class="product-price">20 000 FCFA</div>
      </button>
      <button class="product-card" data-name="Chaussures femme" data-price="25000">
        <img src="products/woman_shoes.jpeg" alt="Shoes woman" />
        <div class="product-name">Chaussures femme</div>
        <div class="product-price">25 000 FCFA</div>
      </button>
      <button class="product-card" data-name="Sac homme" data-price="15000">
        <img src="products/man_bag.webp" alt="Man bag" />
        <div class="product-name">Sac homme</div>
        <div class="product-price">15 000 FCFA</div>
      </button>
      <button class="product-card" data-name="Sac femme" data-price="18000">
        <img src="products/woman_bag.webp" alt="Woman bag" />
        <div class="product-name">Sac femme</div>
        <div class="product-price">18 000 FCFA</div>
      </button>
      <button class="product-card" data-name="Parfum homme" data-price="12000">
        <img src="products/man_perfum.webp" alt="Man perfume" />
        <div class="product-name">Parfum homme</div>
        <div class="product-price">12 000 FCFA</div>
      </button>
      <button class="product-card" data-name="Parfum femme" data-price="14000">
        <img src="products/woman_parfum.webp" alt="Woman perfume" />
        <div class="product-name">Parfum femme</div>
        <div class="product-price">14 000 FCFA</div>
      </button>
    </div>

    <form id="form-sale">
      <div class="field">
        <label for="sale-date" data-i18n="du"></label>
        <input type="date" id="sale-date" required />
      </div>
      <div class="field">
        <label for="sale-client" data-i18n="description_client"></label>
        <input type="text" id="sale-client" placeholder="Client / description" />
      </div>
      <div class="field">
        <label for="sale-amount" data-i18n="montant"></label>
        <input type="number" id="sale-amount" min="0" step="100" required />
      </div>
      <div class="field">
        <label for="sale-mode" data-i18n="mode_paiement"></label>
        <select id="sale-mode">
          <option value="cash">Cash</option>
          <option value="mobile money">Mobile Money</option>
          <option value="bank">Banque</option>
        </select>
      </div>
      <button type="submit" class="btn-primary" data-i18n="ajouter_vente"></button>
    </form>

    <div class="list" id="sales-list"></div>
  </section>

  <!-- DEPENSES -->
  <section id="tab-expenses">
    <h2 data-i18n="enregistrer_depense"></h2>

    <form id="form-expense">
      <div class="field">
        <label for="exp-date" data-i18n="du"></label>
        <input type="date" id="exp-date" required />
      </div>
      <div class="field">
        <label for="exp-nature" data-i18n="nature"></label>
        <input type="text" id="exp-nature" />
      </div>
      <div class="field">
        <label for="exp-amount" data-i18n="montant"></label>
        <input type="number" id="exp-amount" min="0" step="100" required />
      </div>
      <div class="field">
        <label for="exp-supplier" data-i18n="fournisseur"></label>
        <input type="text" id="exp-supplier" />
      </div>
      <button type="submit" class="btn-primary" data-i18n="ajouter_depense"></button>
    </form>

    <div class="list" id="expenses-list"></div>
  </section>

  <!-- RESUME -->
  <section id="tab-summary">
    <h2 data-i18n="resume_precompte"></h2>

    <form id="form-filter">
      <div class="field">
        <label for="filter-start" data-i18n="du"></label>
        <input type="date" id="filter-start" />
      </div>
      <div class="field">
        <label for="filter-end" data-i18n="au"></label>
        <input type="date" id="filter-end" />
      </div>
      <button type="submit" class="btn-primary" data-i18n="filtrer"></button>
    </form>

    <div class="list summary-box">
      <p id="sum-sales"></p>
      <p id="sum-expenses"></p>
      <p id="sum-profit"></p>
      <p id="sum-igs"></p>
      <p id="sum-cac"></p>
      <p id="sum-total"></p>
      <p id="sum-net"></p>
    </div>

    <div class="btn-row">
      <button id="btn-export" class="btn-primary" data-i18n="export_all"></button>
      <button id="btn-whatsapp" class="btn-primary">WhatsApp</button>
    </div>

    <button id="btn-reset" class="btn-primary btn-danger" data-i18n="reset"></button>
  </section>
</main>

<footer>
  <span>OFC Digital – Starter</span>
  <span id="footer-balance">0 FCFA</span>
</footer>

<script>
let currentLang = localStorage.getItem("ofcLang") || "fr";

const i18n = {
  fr: {
    ventes: "Ventes",
    depenses: "Dépenses",
    resume: "Résumé",
    enregistrer_vente: "Enregistrer une vente",
    click_product: "Cliquez sur un produit pour préremplir la vente",
    du: "Date",
    description_client: "Description / Client",
    montant: "Montant (FCFA)",
    mode_paiement: "Mode de paiement",
    ajouter_vente: "Ajouter la vente",
    enregistrer_depense: "Enregistrer une dépense",
    nature: "Nature",
    fournisseur: "Fournisseur (optionnel)",
    ajouter_depense: "Ajouter la dépense",
    resume_precompte: "Résumé & Précompte IGS",
    au: "Au",
    filtrer: "Filtrer",
    reset: "Réinitialiser les données",
    export_all: "Exporter toutes les données",
    aucune_vente: "Aucune vente enregistrée",
    aucune_depense: "Aucune dépense enregistrée",
    ventes_txt: "Ventes",
    depenses_txt: "Dépenses",
    benefice_txt: "Bénéfice",
    igs_txt: "IGS (5%)",
    cac_txt: "CAC (10%)",
    total_precompte_txt: "Total précompte",
    solde_net_txt: "Solde net",
    confirm_reset: "Supprimer toutes les ventes et dépenses ?"
  },
  en: {
    ventes: "Sales",
    depenses: "Expenses",
    resume: "Summary",
    enregistrer_vente: "Record a sale",
    click_product: "Tap a product to pre-fill the sale",
    du: "Date",
    description_client: "Description / Customer",
    montant: "Amount (XAF)",
    mode_paiement: "Payment method",
    ajouter_vente: "Add sale",
    enregistrer_depense: "Record an expense",
    nature: "Expense type",
    fournisseur: "Supplier (optional)",
    ajouter_depense: "Add expense",
    resume_precompte: "Summary & IGS withholding",
    au: "To",
    filtrer: "Filter",
    reset: "Reset data",
    export_all: "Export all data",
    aucune_vente: "No sales recorded",
    aucune_depense: "No expenses recorded",
    ventes_txt: "Sales",
    depenses_txt: "Expenses",
    benefice_txt: "Profit",
    igs_txt: "IGS (5%)",
    cac_txt: "CAC (10%)",
    total_precompte_txt: "Total withholding",
    solde_net_txt: "Net balance",
    confirm_reset: "Delete all sales and expenses?"
  }
};

function translate() {
  document.querySelectorAll("[data-i18n]").forEach(el => {
    const key = el.getAttribute("data-i18n");
    el.textContent = i18n[currentLang][key] || key;
  });
  document.querySelectorAll(".lang-btn").forEach(btn => {
    btn.classList.toggle("active", btn.textContent.toLowerCase() === currentLang);
  });
}

function setLang(lang) {
  currentLang = lang;
  localStorage.setItem("ofcLang", lang);
  translate();
  renderAll();
}

const STORAGE_SALES = "ofcSales";
const STORAGE_EXP = "ofcExpenses";

let sales = [];
let expenses = [];
let filterStart = null;
let filterEnd = null;

function loadData() {
  sales = JSON.parse(localStorage.getItem(STORAGE_SALES) || "[]");
  expenses = JSON.parse(localStorage.getItem(STORAGE_EXP) || "[]");
}

function saveData() {
  localStorage.setItem(STORAGE_SALES, JSON.stringify(sales));
  localStorage.setItem(STORAGE_EXP, JSON.stringify(expenses));
}

function formatAmount(n) {
  return Number(n || 0).toLocaleString("fr-FR") + " FCFA";
}

function inPeriod(date) {
  const d = new Date(date);
  if (filterStart && d < new Date(filterStart)) return false;
  if (filterEnd && d > new Date(filterEnd)) return false;
  return true;
}

function renderSales() {
  const box = document.getElementById("sales-list");
  if (!sales.length) {
    box.textContent = i18n[currentLang].aucune_vente;
    return;
  }
  box.innerHTML = sales
    .slice()
    .reverse()
    .map(s => `
      <div class="row">
        <span>${s.client || "-"}<br><small>${s.date}</small></span>
        <strong>${formatAmount(s.amount)}</strong>
      </div>
    `)
    .join("");
}

function renderExpenses() {
  const box = document.getElementById("expenses-list");
  if (!expenses.length) {
    box.textContent = i18n[currentLang].aucune_depense;
    return;
  }
  box.innerHTML = expenses
    .slice()
    .reverse()
    .map(e => `
      <div class="row">
        <span>${e.nature || "-"}<br><small>${e.date}</small></span>
        <strong>${formatAmount(e.amount)}</strong>
      </div>
    `)
    .join("");
}

function computeSummary() {
  const sFiltered = sales.filter(v => inPeriod(v.date));
  const eFiltered = expenses.filter(d => inPeriod(d.date));

  const totalSales = sFiltered.reduce((t, v) => t + v.amount, 0);
  const totalExp = eFiltered.reduce((t, d) => t + d.amount, 0);
  const profit = totalSales - totalExp;

  const igs = totalSales * 0.05;
  const cac = igs * 0.1;
  const totalPrecompte = igs + cac;
  const net = profit - totalPrecompte;

  document.getElementById("sum-sales").textContent =
    i18n[currentLang].ventes_txt + " : " + formatAmount(totalSales);
  document.getElementById("sum-expenses").textContent =
    i18n[currentLang].depenses_txt + " : " + formatAmount(totalExp);
  document.getElementById("sum-profit").textContent =
    i18n[currentLang].benefice_txt + " : " + formatAmount(profit);
  document.getElementById("sum-igs").textContent =
    i18n[currentLang].igs_txt + " : " + formatAmount(igs);
  document.getElementById("sum-cac").textContent =
    i18n[currentLang].cac_txt + " : " + formatAmount(cac);
  document.getElementById("sum-total").textContent =
    i18n[currentLang].total_precompte_txt + " : " + formatAmount(totalPrecompte);
  document.getElementById("sum-net").textContent =
    i18n[currentLang].solde_net_txt + " : " + formatAmount(net);

  document.getElementById("footer-balance").textContent = formatAmount(net);
}

function renderAll() {
  renderSales();
  renderExpenses();
  computeSummary();
}

function buildExportText() {
  let txt = "OFC Starter - Export\n\n";

  txt += (currentLang === "fr" ? "VENTES\n" : "SALES\n");
  if (!sales.length) txt += (currentLang === "fr" ? "Aucune vente\n" : "No sales\n");
  else sales.forEach(s => {
    txt += `- ${s.date} | ${s.client || ""} | ${s.amount} FCFA | ${s.mode}\n`;
  });

  txt += "\n" + (currentLang === "fr" ? "DÉPENSES\n" : "EXPENSES\n");
  if (!expenses.length) txt += (currentLang === "fr" ? "Aucune dépense\n" : "No expenses\n");
  else expenses.forEach(e => {
    txt += `- ${e.date} | ${e.nature || ""} | ${e.amount} FCFA | ${e.supplier || ""}\n`;
  });

  const totalSales = sales.reduce((t, v) => t + v.amount, 0);
  const totalExp = expenses.reduce((t, d) => t + d.amount, 0);
  const profit = totalSales - totalExp;
  const igs = totalSales * 0.05;
  const cac = igs * 0.1;
  const totalPrecompte = igs + cac;
  const net = profit - totalPrecompte;

  txt += "\n" + (currentLang === "fr" ? "RÉSUMÉ\n" : "SUMMARY\n");
  txt += `${i18n[currentLang].ventes_txt}: ${totalSales} FCFA\n`;
  txt += `${i18n[currentLang].depenses_txt}: ${totalExp} FCFA\n`;
  txt += `${i18n[currentLang].benefice_txt}: ${profit} FCFA\n`;
  txt += `${i18n[currentLang].igs_txt}: ${igs} FCFA\n`;
  txt += `${i18n[currentLang].cac_txt}: ${cac} FCFA\n`;
  txt += `${i18n[currentLang].total_precompte_txt}: ${totalPrecompte} FCFA\n`;
  txt += `${i18n[currentLang].solde_net_txt}: ${net} FCFA\n`;

  return txt;
}

function downloadExport() {
  const txt = buildExportText();
  const blob = new Blob([txt], { type: "text/plain" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "ofc_export.txt";
  a.click();
}

function sendWhatsapp() {
  const txt = buildExportText();
  const encoded = encodeURIComponent(txt);
  window.open("https://wa.me/237687723233?text=" + encoded, "_blank");
}

document.addEventListener("DOMContentLoaded", () => {
  loadData();
  translate();
  renderAll();

  const today = new Date().toISOString().slice(0, 10);
  document.getElementById("sale-date").value = today;
  document.getElementById("exp-date").value = today;

  document.querySelectorAll(".product-card").forEach(card => {
    card.addEventListener("click", () => {
      document.getElementById("sale-client").value = card.dataset.name;
      document.getElementById("sale-amount").value = card.dataset.price;
    });
  });

  document.getElementById("form-sale").addEventListener("submit", e => {
    e.preventDefault();
    sales.push({
      date: document.getElementById("sale-date").value,
      client: document.getElementById("sale-client").value,
      amount: Number(document.getElementById("sale-amount").value),
      mode: document.getElementById("sale-mode").value
    });
    saveData();
    renderAll();
    e.target.reset();
    document.getElementById("sale-date").value = today;
  });

  document.getElementById("form-expense").addEventListener("submit", e => {
    e.preventDefault();
    expenses.push({
      date: document.getElementById("exp-date").value,
      nature: document.getElementById("exp-nature").value,
      amount: Number(document.getElementById("exp-amount").value),
      supplier: document.getElementById("exp-supplier").value
    });
    saveData();
    renderAll();
    e.target.reset();
    document.getElementById("exp-date").value = today;
  });

  document.getElementById("form-filter").addEventListener("submit", e => {
    e.preventDefault();
    filterStart = document.getElementById("filter-start").value || null;
    filterEnd = document.getElementById("filter-end").value || null;
    computeSummary();
  });

  document.getElementById("btn-export").addEventListener("click", downloadExport);
  document.getElementById("btn-whatsapp").addEventListener("click", sendWhatsapp);

  document.getElementById("btn-reset").addEventListener("click", () => {
    if (!confirm(i18n[currentLang].confirm_reset)) return;
    sales = [];
    expenses = [];
    saveData();
    renderAll();
  });

  document.querySelectorAll(".tab-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");

      const tab = btn.dataset.tab;
      document.querySelectorAll("main section").forEach(sec => {
        sec.classList.toggle("active", sec.id === "tab-" + tab);
      });
    });
  });

  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("service-worker.js");
  }
});
</script>
</body>
</html>
